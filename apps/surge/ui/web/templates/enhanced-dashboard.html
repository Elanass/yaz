{% extends "shell.html" %}

{% block title %}SURGE Dashboard - Medical AI Platform{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="gradient-bg text-white py-8">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2">ğŸ¥ SURGE Analytics Dashboard</h1>
                    <p class="text-xl opacity-90">Production Medical Case Management System</p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle Component -->
                    <div id="theme-toggle-container" 
                         data-component="theme-toggle" 
                         data-auto-init="true"></div>
                    
                    <!-- Notification Badge -->
                    <div id="notification-badge-container"
                         data-component="notification-badge"
                         data-auto-init="true"
                         data-count="3"
                         data-href="/notifications"></div>
                </div>
            </div>
            <div class="mt-4 flex items-center space-x-4">
                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm">âœ… Live Demo</span>
                <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">ğŸš€ Pipeline Active</span>
                <span class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm">ğŸ”„ FastHTML + React Islands</span>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Domain Selector -->
        <div class="mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ” Select Medical Domain</h3>
                <div id="domain-selector-container" 
                     data-component="domain-selector" 
                     data-auto-init="true"
                     data-domains='["Gastric Surgery", "Oncology", "Pathology", "Radiology", "Cardiology", "Neurosurgery"]'
                     data-selected-domain="Gastric Surgery"
                     data-htmx-endpoint="/api/v1/htmx/domain-change"
                     data-placeholder="Select a medical domain..."></div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md card-hover" 
                 hx-get="/api/v1/htmx/metrics/total-cases" 
                 hx-trigger="load, every 30s">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-gray-500">Total Cases</h3>
                        <p class="text-3xl font-bold text-blue-600" id="total-cases-value">Loading...</p>
                    </div>
                    <div class="text-blue-500 text-2xl">ğŸ“Š</div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md card-hover"
                 hx-get="/api/v1/htmx/metrics/data-completeness" 
                 hx-trigger="load, every 30s">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-gray-500">Data Completeness</h3>
                        <p class="text-3xl font-bold text-green-600" id="completeness-value">Loading...</p>
                    </div>
                    <div class="text-green-500 text-2xl">âœ…</div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md card-hover"
                 hx-get="/api/v1/htmx/metrics/active-domains" 
                 hx-trigger="load, every 30s">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-gray-500">Active Domains</h3>
                        <p class="text-3xl font-bold text-purple-600" id="domains-value">Loading...</p>
                    </div>
                    <div class="text-purple-500 text-2xl">ğŸ”Œ</div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md card-hover"
                 hx-get="/api/v1/htmx/metrics/avg-survival" 
                 hx-trigger="load, every 30s">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-gray-500">Avg Survival</h3>
                        <p class="text-3xl font-bold text-orange-600" id="survival-value">Loading...</p>
                    </div>
                    <div class="text-orange-500 text-2xl">ğŸ“ˆ</div>
                </div>
            </div>
        </div>

        <!-- Interactive Sections Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Case List Component -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ“‹ Recent Cases</h3>
                <div id="case-list-container"
                     data-component="case-list"
                     data-auto-init="true"
                     data-htmx-endpoint="/api/v1/htmx/cases"
                     data-show-search="true"
                     data-show-filters="true"
                     data-page-size="5"></div>
            </div>
            
            <!-- React Island - OR Board -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ¥ OR Board Status</h3>
                <div id="or-board-island" data-island="ORBoard"></div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- React Island - Calendar -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ“… Surgery Schedule</h3>
                <div id="calendar-island" data-island="Calendar"></div>
            </div>
            
            <!-- Charts Section -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ Analytics Overview</h3>
                <div hx-get="/api/v1/htmx/charts/overview" 
                     hx-trigger="load"
                     hx-target="this"
                     class="min-h-[300px] flex items-center justify-center">
                    <div class="text-gray-500">Loading analytics...</div>
                </div>
            </div>
        </div>

        <!-- Coordination Demo Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h3 class="text-lg font-semibold mb-4">ğŸ”„ Live Coordination Demo</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Dash Adapter -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Dash Integration</h4>
                    <div id="dash-adapter-island" data-island="DashAdapter"></div>
                </div>
                
                <!-- Interact Adapter -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Interact Integration</h4>
                    <div id="interact-adapter-island" data-island="InteractAdapter"></div>
                </div>
                
                <!-- HTMX Coordination -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-2">HTMX Live Updates</h4>
                    <div hx-get="/api/v1/htmx/coordination/status" 
                         hx-trigger="load, every 5s"
                         hx-target="this"
                         class="text-sm">
                        Loading coordination status...
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Insights -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ” Clinical Insights</h3>
                <div hx-get="/api/v1/htmx/insights" 
                     hx-trigger="load"
                     hx-target="this">
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <span class="text-green-500 mr-3 mt-0.5">âœ“</span>
                            <span class="text-gray-700">Loading clinical insights...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸš€ System Status</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">FastHTML Backend</span>
                        <span class="text-green-500 font-semibold">âœ… Active</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">React Islands</span>
                        <span class="text-green-500 font-semibold">âœ… Mounted</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">HTMX Coordination</span>
                        <span class="text-green-500 font-semibold">âœ… Connected</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Dash/Interact Bridge</span>
                        <span class="text-blue-500 font-semibold">ğŸ”„ Coordinated</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.gradient-bg { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
}
.card-hover { 
    transition: transform 0.2s; 
}
.card-hover:hover { 
    transform: translateY(-2px); 
}
</style>

<script>
// Initialize components after DOM load
document.addEventListener('DOMContentLoaded', function() {
    // Auto-initialize all components with data-auto-init="true"
    if (window.ComponentRegistry && typeof window.ComponentRegistry.initializeComponents === 'function') {
        window.ComponentRegistry.initializeComponents();
    }
    
    // Add coordination event listeners
    document.addEventListener('htmx:afterSwap', function(event) {
        // Re-initialize components in swapped content
        const swappedElement = event.detail.target;
        const components = swappedElement.querySelectorAll('[data-component][data-auto-init="true"]');
        components.forEach(component => {
            // Re-initialize component
            const componentType = component.dataset.component;
            if (window.ComponentRegistry && window.ComponentRegistry[componentType]) {
                // Component-specific re-initialization
            }
        });
    });
});
</script>
{% endblock %}
