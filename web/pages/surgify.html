{% extends "pages/base.html" %}
{% block title %}Dashboard â€“ Gastric ADCI{% endblock %}

{% block content %}
<div class="px-4 py-2">
    {% include "components/category_nav.html" %}
</div>

<!-- Featured Series Section -->
<section class="px-4 py-3">
    <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold text-gray-900">Featured Series</h2>
        <button 
            class="text-sm text-blue-600 hover:text-blue-700 font-medium"
            hx-get="/api/v1/series?featured=true&limit=20"
            hx-target="#featured-series-container"
            hx-swap="innerHTML"
        >
            View All
        </button>
    </div>
    
    <div id="featured-series-container">
        {% include "components/card_carousel.html" with items=featured_series %}
    </div>
</section>

<!-- Upcoming Events Section -->
<section class="px-4 py-3">
    <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold text-gray-900">Upcoming Events</h2>
        <button 
            class="text-sm text-blue-600 hover:text-blue-700 font-medium"
            hx-get="/api/v1/events?upcoming=true&limit=20"
            hx-target="#upcoming-events-container"
            hx-swap="innerHTML"
        >
            View All
        </button>
    </div>
    
    <div id="upcoming-events-container">
        {% include "components/card_carousel.html" with items=upcoming_events %}
    </div>
</section>

<!-- Latest Journal Articles Section -->
<section class="px-4 py-3">
    <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold text-gray-900">Latest Journal Articles</h2>
        <button 
            class="text-sm text-blue-600 hover:text-blue-700 font-medium"
            hx-get="/api/v1/journal?limit=20"
            hx-target="#journal-articles-container"
            hx-swap="innerHTML"
        >
            View All
        </button>
    </div>
    
    <div id="journal-articles-container" class="space-y-4">
        {% if journal_articles %}
            {% for article in journal_articles %}
            <div class="flex items-stretch justify-between gap-4 bg-white rounded-xl p-4 shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                <div class="flex flex-col gap-1 flex-[2]">
                    <h3 class="font-bold text-gray-900 text-sm line-clamp-2">
                        {{ article.title }}
                    </h3>
                    <p class="text-gray-600 text-xs">
                        {{ article.author }}
                    </p>
                    <p class="text-gray-500 text-xs line-clamp-2 mt-1">
                        {{ article.abstract or article.description }}
                    </p>
                    
                    <!-- Article Metadata -->
                    <div class="flex items-center gap-3 mt-2">
                        {% if article.journal %}
                        <span class="text-xs text-blue-600 font-medium">
                            {{ article.journal }}
                        </span>
                        {% endif %}
                        
                        {% if article.published_date %}
                        <span class="text-xs text-gray-500">
                            {{ article.published_date.strftime('%b %d, %Y') }}
                        </span>
                        {% endif %}
                        
                        {% if article.impact_factor %}
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">
                            IF: {{ "%.1f"|format(article.impact_factor) }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- Action Button -->
                    <div class="mt-3">
                        <button 
                            class="text-xs bg-blue-50 text-blue-700 font-medium py-2 px-3 rounded-lg hover:bg-blue-100 transition-colors"
                            hx-get="/api/v1/journal/{{ article.id }}"
                            hx-target="#main-content"
                            hx-swap="innerHTML"
                            hx-push-url="true"
                        >
                            Read Article
                        </button>
                    </div>
                </div>
                
                <!-- Article Image -->
                <div class="w-24 h-20 flex-shrink-0">
                    {% if article.image_url %}
                    <div class="w-full h-full bg-cover bg-center rounded-xl" 
                         style="background-image: url('{{ article.image_url }}')">
                    </div>
                    {% else %}
                    <div class="w-full h-full bg-gradient-to-br from-blue-100 to-indigo-200 rounded-xl flex items-center justify-center">
                        <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- Empty State for Journal Articles -->
            <div class="text-center py-8 bg-white rounded-xl border border-gray-200">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
                <h3 class="mt-4 text-sm font-medium text-gray-900">No articles available</h3>
                <p class="mt-2 text-sm text-gray-500">
                    Check back later for new research articles.
                </p>
            </div>
        {% endif %}
    </div>
</section>

<!-- Quick Actions Section -->
<section class="px-4 py-3">
    <h2 class="text-lg font-bold text-gray-900 mb-3">Quick Actions</h2>
    
    <div class="grid grid-cols-2 gap-3">
        <!-- New Case Button -->
        <button 
            class="p-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors"
            hx-get="/cases/new"
            hx-target="#main-content"
            hx-swap="innerHTML"
            hx-push-url="true"
        >
            <div class="flex flex-col items-center space-y-2">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                <span class="text-sm font-medium">New Case</span>
            </div>
        </button>
        
        <!-- ADCI Analysis Button -->
        <button 
            class="p-4 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors"
            hx-get="/analysis/adci"
            hx-target="#main-content"
            hx-swap="innerHTML"
            hx-push-url="true"
        >
            <div class="flex flex-col items-center space-y-2">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4" />
                </svg>
                <span class="text-sm font-medium">ADCI Analysis</span>
            </div>
        </button>
        
        <!-- FLOT Protocol Button -->
        <button 
            class="p-4 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors"
            hx-get="/protocols/flot"
            hx-target="#main-content"
            hx-swap="innerHTML"
            hx-push-url="true"
        >
            <div class="flex flex-col items-center space-y-2">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <span class="text-sm font-medium">FLOT Protocol</span>
            </div>
        </button>
        
        <!-- Surgery Planning Button -->
        <button 
            class="p-4 bg-orange-600 text-white rounded-xl hover:bg-orange-700 transition-colors"
            hx-get="/surgery/planning"
            hx-target="#main-content"
            hx-swap="innerHTML"
            hx-push-url="true"
        >
            <div class="flex flex-col items-center space-y-2">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                </svg>
                <span class="text-sm font-medium">Surgery Plan</span>
            </div>
        </button>
    </div>
</section>

<!-- Custom styles for line clamping -->
<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}
